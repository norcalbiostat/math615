{
  "hash": "bc57a423dfdcad7253894b33e63a054f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Preparing your data for analysis\"\ndate: \"2024-09-11\"\nauthor: \"Robin Donatello\"\nfooter: \"[ðŸ”— https://math615.netlify.app](https://math615.netlify.app) / Preparing your data for analysis\"\nfrom: markdown+emoji\nformat: \n  revealjs:\n    theme: sky\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:\n      width: 200\n---\n\n\n\n[![Data science process](https://d33wubrfki0l68.cloudfront.net/571b056757d68e6df81a3e3853f54d3c76ad6efc/32d37/diagrams/data-science.png){fig-alt=\"A line diagram of figure 1.1 from the book R for Data science\" width=\"682\"}](https://r4ds.hadley.nz/intro)\n\n## Requirements\n\nThese notes assume the following...\n\n* you have R and R Studio installed\n* at least the `tidyverse` and `here` packages installed\n* Converted your Math 615 folder to an R project\n* have successfully rendered a quarto document to PDF. \n\nSee [ASCN Ch 19.1-19.8](https://norcalbiostat.github.io/AppliedStatistics_notes/setup_intro.html) for details if you still need help. \n\n## Import {.smaller}\n\n1. Open your MATH 615 R Project\n2. Create a new Quarto file named `dm_dataset.qmd` where `dataset` is YOUR dataset name. E.g. `dm_addhealth.qmd`.\n3.  Save this file in your `Math615/scripts` folder.\n4.  Copy the following code into a new code chunk.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n## raw <- read_csv(here::here(\"data\", \"data.csv\"))\n```\n:::\n\n\n5.  Replace the `data.csv` with YOUR data set name exactly as it shows in your files window (bottom right).\n6.  Run this code chunk only (not render)\n\n\n::: {.cell}\n\n:::\n\n\n## Confirm import was successful\n\nOkay, did it work?\n\n* Look in the top right Environment pane. Do you see a dataset named `raw`? Does it have an expected number of rows and columns?\n* Click on the table icon to open the data set in a spreadsheet like view. Are the variable names correct? Does the data look correct? \n\n\n## Initial Data Screening {.smaller}\n\nUse functions like `str()` or `glimpse()` to see what data type R thinks your variables are for the whole data set\n\n::: {.panel-tabset}\n## `glimpse`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(raw)    # from the tidyverse/dplyr dataset\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 344\nColumns: 17\n$ studyName             <chr> \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAL0708\", \"PAâ€¦\n$ `Sample Number`       <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 4â€¦\n$ Species               <chr> \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Penguin (Pygoscelis adeliae)\", \"Adelie Pengâ€¦\n$ Region                <chr> \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\", \"Anvers\"â€¦\n$ Island                <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen\",â€¦\n$ Stage                 <chr> \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, 1 Egg Stage\", \"Adult, 1 Egg â€¦\n$ `Individual ID`       <chr> \"N1A1\", \"N1A2\", \"N2A1\", \"N2A2\", \"N3A1\", \"N3A2\", \"N4A1\", \"N4A2\", \"N5A1\", \"N5A2\", \"N6A1\", \"N6A2\", \"N7A1\", \"N7A2\", \"N8A1\", \"N8A2\", \"N9A1\", \"N9A2\", \"N10A1\", \"N10A2\", \"N11A1â€¦\n$ `Clutch Completion`   <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"No\", \"No\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yâ€¦\n$ `Date Egg`            <date> 2007-11-11, 2007-11-11, 2007-11-16, 2007-11-16, 2007-11-16, 2007-11-16, 2007-11-15, 2007-11-15, 2007-11-09, 2007-11-09, 2007-11-09, 2007-11-09, 2007-11-15, 2007-11-15,â€¦\n$ `Culmen Length (mm)`  <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, 42.0, 37.8, 37.8, 41.1, 38.6, 34.6, 36.6, 38.7, 42.5, 34.4, 46.0, 37.8, 37.7, 35.9, 38.2, 38.8, 35.3, 40.6, 40.5, 37â€¦\n$ `Culmen Depth (mm)`   <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, 20.2, 17.1, 17.3, 17.6, 21.2, 21.1, 17.8, 19.0, 20.7, 18.4, 21.5, 18.3, 18.7, 19.2, 18.1, 17.2, 18.9, 18.6, 17.9, 18â€¦\n$ `Flipper Length (mm)` <dbl> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186, 180, 182, 191, 198, 185, 195, 197, 184, 194, 174, 180, 189, 185, 180, 187, 183, 187, 172, 180, 178, 178, 188, 184,â€¦\n$ `Body Mass (g)`       <dbl> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, 4250, 3300, 3700, 3200, 3800, 4400, 3700, 3450, 4500, 3325, 4200, 3400, 3600, 3800, 3950, 3800, 3800, 3550, 3200, 31â€¦\n$ Sex                   <chr> \"MALE\", \"FEMALE\", \"FEMALE\", NA, \"FEMALE\", \"MALE\", \"FEMALE\", \"MALE\", NA, NA, NA, NA, \"FEMALE\", \"MALE\", \"MALE\", \"FEMALE\", \"FEMALE\", \"MALE\", \"FEMALE\", \"MALE\", \"FEMALE\", \"Mâ€¦\n$ `Delta 15 N (o/oo)`   <dbl> NA, 8.94956, 8.36821, NA, 8.76651, 8.66496, 9.18718, 9.46060, NA, 9.13362, 8.63243, NA, NA, NA, 8.55583, NA, 9.18528, 8.67538, 8.47827, 9.11616, 8.73762, 8.66271, 9.222â€¦\n$ `Delta 13 C (o/oo)`   <dbl> NA, -24.69454, -25.33302, NA, -25.32426, -25.29805, -25.21799, -24.89958, NA, -25.09368, -25.21315, NA, NA, NA, -25.22588, NA, -25.06691, -25.13993, -25.23319, -24.7722â€¦\n$ Comments              <chr> \"Not enough blood for isotopes.\", NA, NA, \"Adult not sampled.\", NA, NA, \"Nest never observed with full clutch.\", \"Nest never observed with full clutch.\", \"No blood sampâ€¦\n```\n\n\n:::\n:::\n\n\n\n## `str`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(raw)    \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [344 Ã— 17] (S3: tbl_df/tbl/data.frame)\n $ studyName          : chr [1:344] \"PAL0708\" \"PAL0708\" \"PAL0708\" \"PAL0708\" ...\n $ Sample Number      : num [1:344] 1 2 3 4 5 6 7 8 9 10 ...\n $ Species            : chr [1:344] \"Adelie Penguin (Pygoscelis adeliae)\" \"Adelie Penguin (Pygoscelis adeliae)\" \"Adelie Penguin (Pygoscelis adeliae)\" \"Adelie Penguin (Pygoscelis adeliae)\" ...\n $ Region             : chr [1:344] \"Anvers\" \"Anvers\" \"Anvers\" \"Anvers\" ...\n $ Island             : chr [1:344] \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" ...\n $ Stage              : chr [1:344] \"Adult, 1 Egg Stage\" \"Adult, 1 Egg Stage\" \"Adult, 1 Egg Stage\" \"Adult, 1 Egg Stage\" ...\n $ Individual ID      : chr [1:344] \"N1A1\" \"N1A2\" \"N2A1\" \"N2A2\" ...\n $ Clutch Completion  : chr [1:344] \"Yes\" \"Yes\" \"Yes\" \"Yes\" ...\n $ Date Egg           : Date[1:344], format: \"2007-11-11\" \"2007-11-11\" \"2007-11-16\" \"2007-11-16\" ...\n $ Culmen Length (mm) : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...\n $ Culmen Depth (mm)  : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...\n $ Flipper Length (mm): num [1:344] 181 186 195 NA 193 190 181 195 193 190 ...\n $ Body Mass (g)      : num [1:344] 3750 3800 3250 NA 3450 ...\n $ Sex                : chr [1:344] \"MALE\" \"FEMALE\" \"FEMALE\" NA ...\n $ Delta 15 N (o/oo)  : num [1:344] NA 8.95 8.37 NA 8.77 ...\n $ Delta 13 C (o/oo)  : num [1:344] NA -24.7 -25.3 NA -25.3 ...\n $ Comments           : chr [1:344] \"Not enough blood for isotopes.\" NA NA \"Adult not sampled.\" ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   studyName = col_character(),\n  ..   `Sample Number` = col_double(),\n  ..   Species = col_character(),\n  ..   Region = col_character(),\n  ..   Island = col_character(),\n  ..   Stage = col_character(),\n  ..   `Individual ID` = col_character(),\n  ..   `Clutch Completion` = col_character(),\n  ..   `Date Egg` = col_date(format = \"\"),\n  ..   `Culmen Length (mm)` = col_double(),\n  ..   `Culmen Depth (mm)` = col_double(),\n  ..   `Flipper Length (mm)` = col_double(),\n  ..   `Body Mass (g)` = col_double(),\n  ..   Sex = col_character(),\n  ..   `Delta 15 N (o/oo)` = col_double(),\n  ..   `Delta 13 C (o/oo)` = col_double(),\n  ..   Comments = col_character()\n  .. )\n```\n\n\n:::\n:::\n\n:::\n\nBoth views show you the variable names, data types, and what the data in the first few rows looks like. \n\n## Initial Data Screening - single variable\n\nYou can also look at the data type for a single variable at a time. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntypeof(raw$Island) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"character\"\n```\n\n\n:::\n\n```{.r .cell-code}\nclass(raw$Island) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"character\"\n```\n\n\n:::\n\n```{.r .cell-code}\nstr(raw$Island) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n chr [1:344] \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" \"Torgersen\" ...\n```\n\n\n:::\n:::\n\n\n## Check plausibility of data values\n\nConfirm these values follow the expected values according to the codebook. \n\n<br>\n\nUse `table()` for categorical variables  \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(raw$Island)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   Biscoe     Dream Torgersen \n      168       124        52 \n```\n\n\n:::\n:::\n\n\nand `summary()` on numeric variables to see the range of values present.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(raw$`Body Mass (g)`)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n   2700    3550    4050    4202    4750    6300       2 \n```\n\n\n:::\n:::\n\n\n## Data Prep questions {.smaller}\n\nQuestions to ask yourself (and the data) while reviewing the codebook to choose variables to be used in an analysis.\n\n1. Are there codes that indicate missing? E.g. *MISSING* or *-99*? \n2. Do you need to make response codes more logical? \n    - Some systems will record 1=YES and 2=NO. This should be changed to 0=NO. \n3. Do you need to recode numerical variables to categorical?\n    - Sometimes categorical data will be recorded as 1, 2, 3 etc when those numbers represent named categories. \n4. Do you need to create secondary variables such as an average across measures to create a score. \n5. Are the variable names user friendly? Mixtures of CAPS and lower case, names with spaces or special characters should all be changed. Use the `janitor::clean_names()` function to resolve this. \n\n## How do I know what needs to be done?\n\nSome of these answers will come only after you look at your data. This can be looking at the raw data itself but also looking at tables and charts generated from the data.\n\nOften when you try to create a plot or table you will encounter an error or something odd looking that will be the notification that something has to be adjusted.\n\n## How do I actually make the necessary changes?\n\n-   After you identify what you need to do, you have to find an example of how to code the task you want.\n-   The [Applied Stats Course notes](https://norcalbiostat.github.io/AppliedStatistics_notes/data-management.html) has specific examples on how to handle common changes\n-   Take it one variable at a time.\n\n## Looking for help \n\n* The internets can be a wonderful thing when it comes to learning new things. \n* The R landscape moves fast. Restrict your search to the past ~4 years. \n* Use keywords like `R project` or searching for package `vignette`s\n* Stack Overflow and the Posit Community can have gems!\n\nYou will start to build up your repertoire of bookmarked sites you like to use.  \n\n## Using Chat GPT to write code\n\n:::{.callout-note}\n### Example prompt\nUsing the palmer penguins dataset in R write me R code to change the factor order of the islands variable to put Dream first\n:::\n\n* I told it to use a built in data set\n* I told it to use R\n* I used R terminology such as \"factor order\" and \"variable\"\n\nWhat did it give? \n\n## {#chatgpt data-menu-title=\"Chat GPT's answer\" .smaller}\n\nSure, here's an example of how you can change the factor order of the `island` variable in the Palmer Penguins dataset to put \"Dream\" first using R:\n\n```r\n# Load necessary packages\nlibrary(palmerpenguins)\n\n# Load the dataset\ndata(\"penguins\")\n\n# Check the current levels of the 'island' factor\nlevels(penguins$island)\n\n# Reorder the levels of the 'island' factor to put \"Dream\" first\npenguins$island <- factor(penguins$island, levels = c(\"Dream\", \"Torgersen\", \"Biscoe\"))\n\n# Check the new order of levels\nlevels(penguins$island)\n```\n\nIn this code, we're first loading the `palmerpenguins` package, which provides access to the dataset. Then we load the dataset itself using `data(\"penguins\")`. We check the current levels of the `island` factor using `levels(penguins$island)`.\n\nNext, we use the `factor()` function to reorder the levels of the `island` variable. We specify the desired order of levels using the `levels` argument. In this case, we put \"Dream\" first, followed by the other islands. Finally, we check the new order of levels to make sure the change was successful.\n\nMake sure you have the `palmerpenguins` package installed. You can install it using `install.packages(\"palmerpenguins\")` if you haven't done so already.\n\n## WOW!\n\nNot only did it write the code, it wrote _literate_ code. It has code comments (lines 1, 4, 7, prefixed with a `#`), and a full text explanation. \n\nThis is GREAT for **learning** how to write code!\n\n:::{.callout-important}\n### Plagerism warning\n\nRead the Syllabus on what is expected of you if you use this tool to aid in your writing [https://math615.netlify.app/syllabus#use-of-ai](https://math615.netlify.app/syllabus#use-of-ai)\n:::\n\n:warning: Trust but verify! AI is not always correct! Also, this does not replace the necessity of you learning. \n\n## Closing thoughts\n\n-   Do not underestimate the importance of this step\n-   It will take you far, far longer than you anticipate to 'clean' your data\n-   Effort spent here is a direct correlation with payoff. \n-   Writing code (in any language) will be challenging, but will pay off in the long run\n-   Don't reinvent the wheel. If you want to do something, chances are someone else has done it before. Perhaps even yourself! \n",
    "supporting": [
      "lec03b-data_prep_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}