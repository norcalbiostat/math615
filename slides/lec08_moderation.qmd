---
title: "Moderation and Stratification"
date: "2023-10-30"
description: "11"
---

# Setup

```{r}
#| code-fold: show
library(tidyverse)  # general use
library(ggdist)     # for the "half-violin" plot (stat_slab)
library(ggpubr)     # ggscatter
library(scales)     # axes labeling
library(sjPlot)     # side by side barcharts with numbers
library(gtsummary)  # regression tables

pen <- palmerpenguins::penguins
```

## Motivation - Ex. 1 {.smaller}

Below are the admissions figures for Fall 1973 at UC Berkeley.

|       | Applicants | Admitted |
|-------|------------|----------|
| Total | 12,763     | 41%      |
| Men   | 8,442      | 44%      |
| Women | 4,321      | 35%      |

: Table of admissions rates at UC Berkeley in 1973

Is there evidence of gender bias in college admissions? Do you think a difference of 35% vs 44% is too large to be by chance?

## Department specific data {.smaller}

|            |            |          |            |          |            |          |
|------------|------------|----------|------------|----------|------------|----------|
|            | All        |          | Men        |          | Women      |          |
| Department | Applicants | Admitted | Applicants | Admitted | Applicants | Admitted |
| A          | 933        | 64%      | 825        | 62%      | 108        | **82%**  |
| B          | 585        | 63%      | 560        | 63%      | 25         | **68%**  |
| C          | 918        | 35%      | 325        | 37%      | 593        | 34%      |
| D          | 792        | 34%      | 417        | 33%      | 375        | **35%**  |
| E          | 584        | 25%      | 191        | 28%      | 393        | 24%      |
| F          | 714        | 6%       | 373        | 6%       | 341        | **7%**   |
| Total      | 4526       | 39%      | 2691       | 45%      | 1835       | 30%      |

: The table of admissions rates for the 6 largest departments show a different story.

After adjusting for features such as size and competitiveness of the department, the pooled data showed a "small but statistically significant bias in favor of women"

## Motivation Ex. 2

Can we predict penguin body mass from the flipper length?

::: columns
::: {.column width="50%"}
```{r}
ggscatter(pen, x="flipper_length_mm", y = "body_mass_g", add = "reg.line", 
          color = "island", ellipse = TRUE)
```
:::

::: {.column width="50%"}
Probably, but the relationship between flipper length and body mass changes depending on what island they are found on.
:::
:::

# Moderation {.smaller}

Moderation occurs when the relationship between two variables depends on a third variable.

::: columns
::: {.column width="50%"}
-   The third variable is referred to as the moderating variable or simply the moderator.
-   The moderator affects the direction and/or strength of the relationship between the explanatory ($x$) and response ($y$) variable.
-  So we need a model that can account for this difference in slope. 
:::

::: {.column width="50%"}
[![](https://upload.wikimedia.org/wikipedia/commons/thumb/f/fb/Simpsons_paradox_-_animation.gif/220px-Simpsons_paradox_-_animation.gif){fig-align="center" width="389"}](https://en.wikipedia.org/wiki/Simpson%27s_paradox)
:::
:::

# Stratification {.smaller}

Stratified models fit the regression equations (or any other bivariate analysis) for each subgroup of the population.

The mathematical model describing the relationship between body mass ($Y$), and flipper length ($X$) for each of the species separately would be written as follows:

$$ Y_{ia} \sim \beta_{0a} + \beta_{1a}*x_{i} + \epsilon_{ia} \qquad \epsilon_{ia} \sim \mathcal{N}(0,\sigma^{2}_{a})$$ 
$$ Y_{ic} \sim \beta_{0c} + \beta_{1c}*x_{i} + \epsilon_{ic} \qquad \epsilon_{ic} \sim \mathcal{N}(0,\sigma^{2}_{c}) $$ 
$$ Y_{ig} \sim \beta_{0g} + \beta_{1g}*x_{i} + \epsilon_{ig} \qquad \epsilon_{ig} \sim \mathcal{N}(0,\sigma^{2}_{g}) $$

where $a, c, g$ indicates species *Adelie, Chinstrap* and *Gentoo* respectively.

## Stratification (cont.)

In each model, the intercept, slope, and variance of the residuals can all be different. This is the unique and powerful feature of stratified models. The downside is that each model is only fit on the amount of data in that particular subset. Furthermore, each model has 3 parameters that need to be estimated: $\beta_{0}, \beta_{1}$, and $\sigma^{2}$, for a total of 9 for the three models. The more parameters that need to be estimated, the more data we need.

# Identifying a Moderator

When testing a potential moderator, we are asking the question whether there is an association between two constructs, **but separately for different subgroups within the sample.** - This is also called a *stratified* model, or a *subgroup analysis*.
